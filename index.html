<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Info4Wheelchair ‚ôø</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>

:root {
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --background: #f8fafc;
            --text: #0f172a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        body {
            background: var(--background);
            color: var(--text);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .title {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }

        .search-section {
            display: grid;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .location-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .location-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .category-card {
            background: white;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .category-title {
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .options-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: background 0.2s;
        }

        .checkbox-label:hover {
            background: #f1f5f9;
        }

        .search-button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.2s;
            width: 100%;
        }

        .search-button:hover {
            background: var(--primary-hover);
        }

        #map {
            height: 500px;
            border-radius: 1rem;
            margin-top: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .title {
                font-size: 2rem;
            }
        }
        @media (max-width: 480px) {
            .location-input {
                font-size: 0.9rem;
            }

            .search-button {
                padding: 0.8rem 1.5rem;
                font-size: 0.9rem;
            }
        }
        .cuisine-checkbox {
            margin-left: 1.5rem;
            opacity: 0.8;
        }

        .notification {
            position: fixed;
            top: 1rem;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary);
            color: white;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            font-size: 1rem;
            z-index: 1000;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .notification.hidden {
            opacity: 0;
            transform: translateX(-50%) translateY(-20px);
            pointer-events: none;
        }

        .search-all-button {
            background: #10b981;
        }
        
        .search-all-button:hover {
            background: #059669;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="title">
                ‚ôø Info4Wheelchair
            </h1>
            <p>Find wheelchair-accessible places in your area</p>
        </header>
        <div class="legenda">
            <h4>MODR√ù ≈†PENDL√çK - M√çSTA VHODN√Å PRO VOZ√çƒåK√Å≈òE (WHEELCHAIR ACCESS - YES)</h4>
            <h4><img src="https://upload.wikimedia.org/wikipedia/commons/b/b7/Lock-red.svg" alt="Red Icon" style="width: 25px; height: 25px;"> - M√çSTA ƒå√ÅSTEƒåNƒö VHODN√Å PRO VOZ√çƒåK√Å≈òE (WHEELCHAIR ACCESS - LIMITED)</h4>
        </div>
        <br>
        <hr>
        <br>
        <main>
            <button class="search-button" style="background:#ef4444;" onclick="clearMarkers()">üóëÔ∏è Clear All Markers</button>
            <br>
            <hr>
            <br> 
            <section class="search-section">
                <input type="text" 
                       class="location-input" 
                       placeholder="Enter location or address..."
                       id="locationInput">

                <div class="categories-grid">
                    <div class="category-card">
                    <label class="checkbox-label">
                        <input type="checkbox" class="select-all" data-target="food-drinks">
                        Select All
                    </label>
                </div>
                
                    <!-- Food & Drinks -->
                    <div class="category-card">
                        <h3 class="category-title">
                            Food & Drinks
                        </h3>
                        <div class="options-list food-drinks">
                            <label class="checkbox-label">
                                <input type="checkbox" value="restaurant">
                                Restaurants
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" value="cafe">
                                Caf√©s
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" value="bar">
                                Bars
                            </label>
                            <div class="sub-options">
                                <h4>
                                    Cuisine Types:
                                    
                                </h4>
                                <label class="checkbox-label cuisine-checkbox">
                                    <input type="checkbox" value="italian">
                                    Italian
                                </label>
                                <label class="checkbox-label cuisine-checkbox">
                                    <input type="checkbox" value="mexican">
                                    Mexican
                                </label>
                                <label class="checkbox-label cuisine-checkbox">
                                    <input type="checkbox" value="asian">
                                    Asian
                                </label>
                                <label class="checkbox-label cuisine-checkbox">
                                    <input type="checkbox" value="vegetarian">
                                    Vegetarian
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Healthcare -->
                    <div class="category-card">
                        <h3 class="category-title">Healthcare</h3>
                        <div class="options-list">
                            <label class="checkbox-label">
                                <input type="checkbox" value="pharmacy">
                                Pharmacies
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" value="hospital">
                                Hospitals
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" value="clinic">
                                Clinics
                            </label>
                        </div>
                    </div>

                    <!-- Finance -->
                    <div class="category-card">
                        <h3 class="category-title">Finance</h3>
                        <div class="options-list">
                            <label class="checkbox-label">
                                <input type="checkbox" value="bank">
                                Banks
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" value="atm">
                                ATMs
                            </label>
                        </div>
                    </div>

                    <!-- Transportation -->
                    <div class="category-card">
                        <h3 class="category-title">Transportation</h3>
                        <div class="options-list">
                            <label class="checkbox-label">
                                <input type="checkbox" value="bus_station">
                                Bus Stations
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" value="taxi">
                                Taxi Stands
                            </label>
                        </div>
                    </div>

                    <!-- Lodging -->
                    <div class="category-card">
                        <h3 class="category-title">Lodging</h3>
                        <div class="options-list">
                            <label class="checkbox-label">
                                <input type="checkbox" value="hotel">
                                Hotels
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" value="hostel">
                                Hostels
                            </label>
                        </div>
                    </div>

                    <!-- Public Services -->
                    <div class="category-card">
                        <h3 class="category-title">Public Services</h3>
                        <div class="options-list">
                            <label class="checkbox-label">
                                <input type="checkbox" value="post_office">
                                Post Offices
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" value="library">
                                Libraries
                            </label>
                        </div>
                    </div>

                    <!-- Education -->
                    <div class="category-card">
                        <h3 class="category-title">Education</h3>
                        <div class="options-list">
                            <label class="checkbox-label">
                                <input type="checkbox" value="school">
                                Schools
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" value="university">
                                Universities
                            </label>
                        </div>
                    </div>

                    <!-- Entertainment -->
                    <div class="category-card">
                        <h3 class="category-title">Entertainment</h3>
                        <div class="options-list">
                            <label class="checkbox-label">
                                <input type="checkbox" value="cinema">
                                Cinemas
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" value="theatre">
                                Theatres
                            </label>
                        </div>
                    </div>
                    <!-- Parks & Recreation -->
                    <div class="category-card">
                        <h3 class="category-title">Parks & Recreation</h3>
                        <div class="options-list">
                            <label class="checkbox-label">
                                <input type="checkbox" value="park">
                                Parks
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" value="playground">
                                Playgrounds
                            </label>
                        </div>
                    
                </div>
                    <!-- Other Amenities -->
                    <div class="category-card">
                        <h3 class="category-title">Other Amenities</h3>
                        <div class="options-list">
                            <label class="checkbox-label">
                                <input type="checkbox" value="toilets">
                                Public Toilets
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" value="parking">
                                Parking
                            </label>
                        </div>
                    </div>
                    <!--Emergency-->
                    <div class="category-card">
                        <h3 class="category-title">Emergency</h3>
                        <div class="options-list">
                            <label class="checkbox-label">
                                <input type="checkbox" value="fire_station">
                                Fire Stations
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" value="police">
                                Police Stations
                            </label>
                        </div>
            </div>
            </div>

                <button class="search-button" id="searchButton">
                    Search Accessible Places
                </button>
                <button class="search-button search-all-button" id="searchAllButton">
                    Search ALL Wheelchair Accessible Places <i>(ALL IN YOUR TYPED LOCATION! NO FILTER NEEDED!)</i>
                </button>
            </section>

            <!-- Notification Section -->
            <div id="notification" class="notification hidden"></div>

            <div id="map"></div>
        </main>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        const cachedMarkers = [];

        const map = L.map('map').setView([50.0755, 14.4378], 13);
        L.tileLayer('https://tile.thunderforest.com/locus-4za/{z}/{x}/{y}.png?apikey=f944003b5ba34ff3a30dafe96e581f06').addTo(map);

        const redIcon = L.icon({
            iconUrl: 'https://upload.wikimedia.org/wikipedia/commons/b/b7/Lock-red.svg',
            iconSize: [32, 32],
            iconAnchor: [16, 32],
            popupAnchor: [0, -32]
        });

        async function fetchWheelchairData() {
            const location = document.getElementById('locationInput').value;
            const notification = document.getElementById('notification');

            function showNotification(message) {
                notification.textContent = message;
                notification.classList.remove('hidden');
            }

            function hideNotification() {
                notification.classList.add('hidden');
            }

            if (!location) {
                showNotification('Please enter a location.');
                setTimeout(hideNotification, 3000);
                return;
            }

            showNotification('Searching for places...');
            try {
                const geocodeResponse = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(location)}`);
                const geocodeData = await geocodeResponse.json();

                if (geocodeData.length === 0) {
                    showNotification('Location not found. Please try a different query.');
                    setTimeout(hideNotification, 3000);
                    return;
                }

                const { lat, lon } = geocodeData[0];
                map.setView([lat, lon], 13);

                const amenities = Array.from(document.querySelectorAll('input[type="checkbox"]:not(.cuisine-checkbox):checked')).map(cb => cb.value);
                const cuisines = Array.from(document.querySelectorAll('.cuisine-checkbox:checked')).map(cb => cb.value);

                const hasRestaurant = amenities.includes('restaurant');
                const otherAmenities = amenities.filter(a => a !== 'restaurant');
                const hasParks = amenities.includes('park');
                const hasPlaygrounds = amenities.includes('playground');

                let restaurantQuery = '';
                if (hasRestaurant) {
                    restaurantQuery = cuisines.length > 0 
                        ? `node["amenity"="restaurant"]["cuisine"~"${cuisines.join('|')}"](area.searchArea);` 
                        : `node["amenity"="restaurant"](area.searchArea);`;
                }

                let parkQuery = hasParks 
                    ? `node["leisure"="park"](area.searchArea);` 
                    : '';
                let playgroundQuery = hasPlaygrounds
                    ? `node["leisure"="playground"](area.searchArea);` 
                    : '';

                let otherQuery = otherAmenities.length > 0 
                    ? `node["amenity"~"${otherAmenities.join('|')}"](area.searchArea);` 
                    : '';

                const overpassQuery = `
                    [out:json];
                    area[name="${location}"]->.searchArea;
                    (
                        ${restaurantQuery}
                        ${otherQuery}
                        ${parkQuery}
                        ${playgroundQuery}
                        way["wheelchair"](area.searchArea);
                        relation["wheelchair"](area.searchArea);
                    );
                    out center tags;
                `;

                const response = await fetch('https://overpass-api.de/api/interpreter', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'
                    },
                    body: `data=${encodeURIComponent(overpassQuery)}`
                });

                const data = await response.json();
                if (data.elements.length === 0) {
                    showNotification('No results found.');
                    setTimeout(hideNotification, 3000);
                } else {
                    hideNotification();
                }
                displayResults(data.elements);
            } catch (error) {
                console.error('Error fetching data:', error);
                showNotification('Done or error.');
                setTimeout(hideNotification, 3000);
            }
        }

        async function fetchAllWheelchairPlaces() {
            const location = document.getElementById('locationInput').value;
            const notification = document.getElementById('notification');

            function showNotification(message) {
                notification.textContent = message;
                notification.classList.remove('hidden');
            }

            function hideNotification() {
                notification.classList.add('hidden');
            }

            if (!location) {
                showNotification('Please enter a location.');
                setTimeout(hideNotification, 3000);
                return;
            }

            showNotification('Searching for all wheelchair accessible places...');

            try {
                const geocodeResponse = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(location)}`);
                const geocodeData = await geocodeResponse.json();

                if (geocodeData.length === 0) {
                    showNotification('Location not found. Please try a different query.');
                    setTimeout(hideNotification, 3000);
                    return;
                }

                const { lat, lon } = geocodeData[0];
                map.setView([lat, lon], 13);

                const overpassQuery = `
                    [out:json];
                    area[name="${location}"]->.searchArea;
                    (
                        node["wheelchair"="yes"](area.searchArea);
                        node["wheelchair"="limited"](area.searchArea);
                        way["wheelchair"="yes"](area.searchArea);
                        way["wheelchair"="limited"](area.searchArea);
                        relation["wheelchair"="yes"](area.searchArea);
                        relation["wheelchair"="limited"](area.searchArea);
                    );
                    out center tags;
                `;

                const response = await fetch('https://overpass-api.de/api/interpreter', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'
                    },
                    body: `data=${encodeURIComponent(overpassQuery)}`
                });

                const data = await response.json();
                if (data.elements.length === 0) {
                    showNotification('No wheelchair accessible places found.');
                    setTimeout(hideNotification, 3000);
                } else {
                    showNotification(`Found ${data.elements.length} wheelchair accessible places!`);
                    setTimeout(hideNotification, 3000);
                }
                displayResults(data.elements);

            } catch (error) {
                console.error('Error:', error);
                showNotification('Done or error.');
                setTimeout(hideNotification, 3000);
            }
        }

        async function handleSearchCompletion(places) {
            if (places.length < 2) {
                console.warn('Not enough places to calculate routes.');
                return;
            }

            const start = { lat: places[0].lat, lon: places[0].lon };
            const end = { lat: places[1].lat, lon: places[1].lon };

            // Calculate route accessibility
            await calculateRouteAccessibility(start, end);

            // Find nearest parking for the end location
            await findNearestParking(end.lat, end.lon);
        }

        function displayResults(places) {
    const currentCache = JSON.parse(localStorage.getItem('cachedMarkers') || '[]');
    const newData = [];

    places.forEach(place => {
        if (!place.lat || !place.lon || !place.tags) return;

        const tags = place.tags;
        const wheelchair = tags.wheelchair;

        if (wheelchair !== 'yes' && wheelchair !== 'limited') return;

        const markerOptions = wheelchair === 'limited' ? { icon: redIcon } : {};
        const latlng = [place.lat, place.lon];
        const marker = L.marker(latlng, markerOptions).addTo(map);
        const address = tags["addr:street"] || 'unknown';

        marker.bindPopup(`
            <strong>${tags.name || 'Unnamed Place'}</strong><br>
            Wheelchair: ${wheelchair}<br>
            Type: ${tags.amenity || 'unknown'}<br>
            Address: ${address}<br>
            <a href="https://www.openstreetmap.org/?mlat=${place.lat}&mlon=${place.lon}#map=18/${place.lat}/${place.lon}" target="_blank">View on OSM</a>
        `);

        marker.on('click', () => map.panTo(latlng));

        cachedMarkers.push(marker);

        // P≈ôidat do nov√© cache
        newData.push({
            lat: place.lat,
            lon: place.lon,
            name: tags.name || 'Unnamed Place',
            amenity: tags.amenity || '',
            wheelchair,
            address
        });
    });

    // Slouƒçit s existuj√≠c√≠ cache bez duplicit (na z√°kladƒõ pozice)
    const merged = [...currentCache];

    newData.forEach(newPlace => {
        const exists = merged.some(p => p.lat === newPlace.lat && p.lon === newPlace.lon);
        if (!exists) merged.push(newPlace);
    });

    localStorage.setItem('cachedMarkers', JSON.stringify(merged));

    handleSearchCompletion(places);
}


        async function calculateRouteAccessibility(start, end) {
            const notification = document.getElementById('notification');

            function showNotification(message) {
                notification.textContent = message;
                notification.classList.remove('hidden');
            }

            function hideNotification() {
                notification.classList.add('hidden');
            }

            showNotification('Calculating route accessibility...');

            try {
                const routeResponse = await fetch(`https://routing.openstreetmap.de/routed-foot/route/v1/driving/${start.lon},${start.lat};${end.lon},${end.lat}?overview=full&geometries=geojson`);
                const routeData = await routeResponse.json();

                if (!routeData.routes || routeData.routes.length === 0) {
                    showNotification('No route found.');
                    setTimeout(hideNotification, 3000);
                    return;
                }

                const route = routeData.routes[0];
                const coordinates = route.geometry.coordinates.map(coord => [coord[1], coord[0]]);
                const routeLayer = L.polyline(coordinates, { color: 'blue', weight: 4 }).addTo(map);

                // Fetch surface data along the route
                const surfaceQuery = `
                    [out:json];
                    (
                        way["surface"](poly:"${coordinates.map(c => `${c[0]} ${c[1]}`).join(' ')}");
                    );
                    out tags;
                `;
                const surfaceResponse = await fetch('https://overpass-api.de/api/interpreter', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8' },
                    body: `data=${encodeURIComponent(surfaceQuery)}`
                });
                const surfaceData = await surfaceResponse.json();

                const surfaceCounts = surfaceData.elements.reduce((acc, way) => {
                    const surface = way.tags.surface || 'unknown';
                    acc[surface] = (acc[surface] || 0) + 1;
                    return acc;
                }, {});

                const totalWays = Object.values(surfaceCounts).reduce((sum, count) => sum + count, 0);
                const surfacePercentages = Object.entries(surfaceCounts).map(([surface, count]) => ({
                    surface,
                    percentage: ((count / totalWays) * 100).toFixed(2)
                }));

                showNotification(`Route calculated. Surfaces: ${surfacePercentages.map(s => `${s.surface}: ${s.percentage}%`).join(', ')}`);
                setTimeout(hideNotification, 5000);

                // Remove route on map click
                map.on('click', () => map.removeLayer(routeLayer));
            } catch (error) {
                console.error('Error calculating route:', error);
                showNotification('Failed to calculate route.');
                setTimeout(hideNotification, 3000);
            }
        }

        async function findNearestParking(lat, lon) {
            const notification = document.getElementById('notification');

            function showNotification(message) {
                notification.textContent = message;
                notification.classList.remove('hidden');
            }

            function hideNotification() {
                notification.classList.add('hidden');
            }

            showNotification('Searching for nearest wheelchair-accessible parking...');

            const parkingQuery = `
                [out:json];
                node["amenity"="parking"]["wheelchair"="yes"](around:5000,${lat},${lon});
                out center;
            `;

            try {
                const response = await fetch('https://overpass-api.de/api/interpreter', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8' },
                    body: `data=${encodeURIComponent(parkingQuery)}`
                });

                const data = await response.json();
                if (data.elements.length === 0) {
                    showNotification('No wheelchair-accessible parking found nearby.');
                    setTimeout(hideNotification, 3000);
                    return;
                }

                const nearestParking = data.elements[0];
                const marker = L.marker([nearestParking.lat, nearestParking.lon], { icon: redIcon }).addTo(map);
                marker.bindPopup(`
                    <strong>Nearest Parking</strong><br>
                    Wheelchair: Yes<br>
                    <a href="https://www.openstreetmap.org/?mlat=${nearestParking.lat}&mlon=${nearestParking.lon}#map=18/${nearestParking.lat}/${nearestParking.lon}" target="_blank">View on OSM</a>
                `).openPopup();

                map.panTo([nearestParking.lat, nearestParking.lon]);
                showNotification('Nearest parking displayed on map.');
                setTimeout(hideNotification, 3000);
            } catch (error) {
                console.error('Error finding parking:', error);
                showNotification('Failed to find parking.');
                setTimeout(hideNotification, 3000);
            }
        }

        document.querySelectorAll('.select-all').forEach(selectAllCheckbox => {
            selectAllCheckbox.addEventListener('change', function () {
                const targetClass = this.dataset.target;
                const checkboxes = document.querySelectorAll(`input[type="checkbox"]:not(.select-all)`);
                checkboxes.forEach(checkbox => {
                    checkbox.checked = this.checked;
                });
            });
        });

        function clearMarkers() {
            cachedMarkers.forEach(marker => map.removeLayer(marker));
            cachedMarkers.length = 0;
            localStorage.removeItem('cachedMarkers'); // ‚úÖ sma≈æeme i localStorage
        }



        document.getElementById('searchButton').addEventListener('click', fetchWheelchairData);
        document.getElementById('searchAllButton').addEventListener('click', fetchAllWheelchairPlaces);
        document.getElementById('locationInput').addEventListener('keypress', e => e.key === 'Enter' && fetchWheelchairData());

        function loadCachedMarkers() {
    const savedMarkers = JSON.parse(localStorage.getItem('cachedMarkers') || '[]');

    savedMarkers.forEach(data => {
        const markerOptions = data.wheelchair === 'limited' ? { icon: redIcon } : {};
        const marker = L.marker([data.lat, data.lon], markerOptions).addTo(map);

        marker.bindPopup(`
            <strong>${data.name}</strong><br>
            Wheelchair: ${data.wheelchair}<br>
            Type: ${data.amenity}<br>
            Address: ${data.address}<br>
            <a href="https://www.openstreetmap.org/?mlat=${data.lat}&mlon=${data.lon}#map=18/${data.lat}/${data.lon}" target="_blank">View on OSM</a>
        `);

        cachedMarkers.push(marker);
    });

    // Naƒç√≠st pozici mapy z localStorage
    const savedPosition = JSON.parse(localStorage.getItem('mapPosition'));
    if (savedPosition) {
        map.setView([savedPosition.lat, savedPosition.lng], savedPosition.zoom);
    }
    map.setView([50.0755, 14.4378], 13); // Reset to default view if no saved position
    map.setZoom(13); // Reset to default zoom if no saved position
   
}

// ‚¨ÖÔ∏è Spustit p≈ôi naƒçten√≠ str√°nky
window.addEventListener('DOMContentLoaded', loadCachedMarkers);

map.on('moveend', () => {
    const center = map.getCenter();
    const zoom = map.getZoom();
    localStorage.setItem('mapPosition', JSON.stringify({ lat: center.lat, lng: center.lng, zoom }));
});

// ‚¨ÖÔ∏è Naƒç√≠st pozici mapy p≈ôi naƒçten√≠ str√°nky
window.onload = () => {
    const savedPosition = JSON.parse(localStorage.getItem('mapPosition'));
    if (savedPosition) {
        map.setView([savedPosition.lat, savedPosition.lng], savedPosition.zoom);
    }
};



    </script>
</body>
</html>